# üöÇ Railway Production Environment Variables
# LR-EMS - https://lrems.up.railway.app/

## ‚ö†Ô∏è IMPORTANT SECURITY NOTICE
This file contains PLACEHOLDER values. Replace them with your actual production values.
DO NOT commit this file with real values to Git!

---

## üì¶ BACKEND SERVICE - Environment Variables

### Required for Railway Backend Service

```bash
# -----------------
# Server Configuration
# -----------------
NODE_ENV=production
PORT=3000

# -----------------
# Database Configuration (MongoDB)
# -----------------
# Get this from your MongoDB Atlas cluster
# Format: mongodb+srv://USERNAME:PASSWORD@CLUSTER.mongodb.net/DATABASE_NAME?retryWrites=true&w=majority
DATABASE_URL=mongodb+srv://YOUR_MONGODB_USERNAME:YOUR_MONGODB_PASSWORD@YOUR_CLUSTER.mongodb.net/lrems?retryWrites=true&w=majority

# Legacy database fields (optional, can leave empty if using DATABASE_URL)
DB_HOST=
DB_PORT=
DB_NAME=lrems
DB_USER=
DB_PASSWORD=
DB_POOL_MIN=2
DB_POOL_MAX=10

# -----------------
# JWT Authentication
# -----------------
# CRITICAL: Replace these with the secrets generated by `node generate-secrets.js`
# These MUST be different from development and kept SECRET
JWT_SECRET=REPLACE_WITH_SECURE_RANDOM_STRING_FROM_GENERATE_SECRETS
JWT_REFRESH_SECRET=REPLACE_WITH_DIFFERENT_SECURE_RANDOM_STRING_FROM_GENERATE_SECRETS
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d

# -----------------
# Security Configuration
# -----------------
BCRYPT_ROUNDS=12

# CORS Configuration
# CRITICAL: Set this to your exact Railway frontend URL
CORS_ORIGIN=https://lrems.up.railway.app

# -----------------
# Rate Limiting
# -----------------
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# -----------------
# Logging Configuration
# -----------------
LOG_LEVEL=info
LOG_FILE=logs/app.log

# -----------------
# Feature Flags
# -----------------
ENABLE_AUTH=true
ENABLE_AUDIT=true
ENABLE_CACHE=false
```

---

## üé® FRONTEND SERVICE - Environment Variables

### Required for Railway Frontend Service

```bash
# -----------------
# API Configuration
# -----------------
# CRITICAL: Set this to your Railway backend service URL
# Format: https://YOUR-BACKEND-SERVICE.up.railway.app/api
# Note: Include /api at the end, no trailing slash
VITE_API_BASE_URL=https://YOUR-BACKEND-SERVICE.up.railway.app/api
```

**Important:** You need to find your backend service URL from Railway dashboard.

---

## üìã Step-by-Step Setup Instructions

### Step 1: Get MongoDB Connection String

1. Go to [MongoDB Atlas](https://cloud.mongodb.com)
2. Click your cluster ‚Üí "Connect"
3. Choose "Connect your application"
4. Copy the connection string
5. Replace `<password>` with your actual database password
6. Replace `<database>` or add `/lrems` before the `?`

**Example:**
```
mongodb+srv://lrems_user:MySecurePassword123@cluster0.abc12.mongodb.net/lrems?retryWrites=true&w=majority
```

### Step 2: Generate JWT Secrets

Run this command in your local terminal:
```bash
node generate-secrets.js
```

Copy the two generated secrets:
- First one ‚Üí `JWT_SECRET`
- Second one ‚Üí `JWT_REFRESH_SECRET`

### Step 3: Find Your Railway Backend URL

1. Go to Railway dashboard
2. Click on your **backend** service
3. Go to "Settings" tab
4. Look for "Domains" section
5. Copy the URL (e.g., `https://lrems-backend-production.up.railway.app`)

### Step 4: Configure Backend Variables in Railway

1. In Railway, click your **backend** service
2. Go to "Variables" tab
3. Add each variable one by one from the Backend section above
4. **Critical variables to update:**
   - `DATABASE_URL` ‚Üí Your MongoDB connection string
   - `JWT_SECRET` ‚Üí First secret from generate-secrets.js
   - `JWT_REFRESH_SECRET` ‚Üí Second secret from generate-secrets.js
   - `CORS_ORIGIN` ‚Üí `https://lrems.up.railway.app`

### Step 5: Configure Frontend Variables in Railway

1. In Railway, click your **frontend** service  
2. Go to "Variables" tab
3. Add `VITE_API_BASE_URL` with your backend URL + `/api`
   - Example: `https://lrems-backend-production.up.railway.app/api`

### Step 6: Redeploy Services

1. Backend will auto-redeploy when you save variables
2. Frontend will auto-redeploy when you save variables
3. Wait for both to finish deploying

### Step 7: Test Your Deployment

1. **Test Backend Health:**
   - Visit: `https://YOUR-BACKEND-URL.up.railway.app/health`
   - Should return: `{"status":"OK",...}`

2. **Test Frontend:**
   - Visit: `https://lrems.up.railway.app/`
   - Should see the login page
   - Try logging in

3. **Check Browser Console:**
   - Open browser DevTools (F12)
   - Look for any CORS errors
   - All API calls should succeed

---

## ‚úÖ Production Environment Variables Checklist

### Backend Service (Check all are set):

- [ ] `NODE_ENV=production`
- [ ] `DATABASE_URL=` (MongoDB Atlas connection string)
- [ ] `JWT_SECRET=` (Secure random string from generator)
- [ ] `JWT_REFRESH_SECRET=` (Different secure random string)
- [ ] `JWT_EXPIRES_IN=15m`
- [ ] `JWT_REFRESH_EXPIRES_IN=7d`
- [ ] `BCRYPT_ROUNDS=12`
- [ ] `CORS_ORIGIN=https://lrems.up.railway.app`
- [ ] `RATE_LIMIT_WINDOW_MS=900000`
- [ ] `RATE_LIMIT_MAX_REQUESTS=100`
- [ ] `LOG_LEVEL=info`

### Frontend Service (Check all are set):

- [ ] `VITE_API_BASE_URL=` (Your backend URL + `/api`)

---

## üîç How to Verify Everything is Working

### ‚úÖ Backend is Correctly Configured:
1. Health endpoint responds: `https://YOUR-BACKEND/health`
2. No errors in Railway logs
3. Database connection successful

### ‚úÖ Frontend is Correctly Configured:
1. App loads at: `https://lrems.up.railway.app/`
2. Login page appears
3. Can successfully login
4. No CORS errors in browser console

### ‚úÖ Integration Works:
1. Can create, edit, delete books
2. Can manage evaluators
3. All features work as expected
4. No 401/403/500 errors

---

## üêõ Common Issues & Solutions

### Issue: CORS Error in Browser
**Symptoms:** "Access to fetch has been blocked by CORS policy"

**Solution:**
1. Check `CORS_ORIGIN` in backend exactly matches: `https://lrems.up.railway.app`
2. No trailing slash in CORS_ORIGIN
3. Must use `https://` not `http://`
4. Redeploy backend after changing

### Issue: Cannot Connect to Database
**Symptoms:** "MongoServerError" in Railway logs

**Solution:**
1. Verify MongoDB Atlas username/password in `DATABASE_URL`
2. Check MongoDB Atlas Network Access allows `0.0.0.0/0`
3. Database name is included in connection string

### Issue: Frontend Can't Reach Backend
**Symptoms:** Network errors, API calls timeout

**Solution:**
1. Verify `VITE_API_BASE_URL` includes `/api` at the end
2. No trailing slash after `/api`
3. Backend URL is correct and accessible
4. Test backend health endpoint directly

### Issue: Authentication Not Working
**Symptoms:** Login fails, JWT errors

**Solution:**
1. Check `JWT_SECRET` and `JWT_REFRESH_SECRET` are set
2. Secrets must be long random strings (not the placeholders)
3. Redeploy backend after setting secrets

---

## üìû Next Steps

1. ‚úÖ Generate JWT secrets: `node generate-secrets.js`
2. ‚úÖ Get MongoDB connection string from Atlas
3. ‚úÖ Find your Railway backend URL
4. ‚úÖ Set all backend environment variables in Railway
5. ‚úÖ Set frontend environment variables in Railway
6. ‚úÖ Wait for auto-redeploy
7. ‚úÖ Test at https://lrems.up.railway.app/

---

## üîê Security Reminders

- ‚úÖ Never commit `.env` files with real values
- ‚úÖ Use strong, random JWT secrets (generated by script)
- ‚úÖ Keep database credentials secure
- ‚úÖ Set CORS_ORIGIN to specific domain (not `*`)
- ‚úÖ Use environment variables, never hardcode secrets
- ‚úÖ Regularly rotate JWT secrets in production

---

**üìù Note:** This file is a reference guide. The actual environment variables must be set in Railway's dashboard, not in a file.

**üéâ Good luck with your production deployment!**
